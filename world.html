<!-- world.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World | SuperWorld</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #0f0f0f;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      background-color: #1e1e1e;
      display: block;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      color: white;
      padding: 10px;
      box-sizing: border-box;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .button, select, input {
      padding: 8px 12px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background: #ff9100;
      color: #000;
      cursor: pointer;
    }
    .button:hover {
      background: #ffaa00;
    }
    #gameCanvas {
      width: 100vw;
      height: calc(100vh - 120px);
    }
  </style>
</head>
<body>
  <div id="ui">
    <div class="row">
      <span id="info">Memuat world...</span>
      <button class="button" onclick="logout()">Logout</button>
    </div>
    <div class="row">
      <input id="worldInput" placeholder="Masukkan nama world">
      <button class="button" onclick="loadWorld()">Masuk World</button>
      <button class="button" onclick="saveWorld()">Simpan</button>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCYLbIFVfaO487KN2z4ABDPTx1j0mBHF-o",
      authDomain: "superworld1.firebaseapp.com",
      databaseURL: "https://superworld1-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "superworld1",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const uid = localStorage.getItem("uid");
    if (!uid) window.location.href = "login.html";

    let worldId = "default";
    const tileSize = 32;
    const worldSize = 20;
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let world = [];
    let player = { x: 5, y: 5, frame: 1, image: new Image() };
    player.image.src = `asset/hero/Idle (1).png`;

    function logout() {
      localStorage.removeItem("uid");
      window.location.href = "login.html";
    }

    function drawWorld() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < worldSize; y++) {
        for (let x = 0; x < worldSize; x++) {
          if (world[y][x] === 1) {
            ctx.fillStyle = "#6c6";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          }
        }
      }
      ctx.drawImage(player.image, player.x * tileSize, player.y * tileSize, tileSize, tileSize);
    }

    function loadWorld() {
      worldId = document.getElementById("worldInput").value || "default";
      db.ref("worlds/" + worldId).once("value").then(snapshot => {
        if (snapshot.exists()) {
          world = snapshot.val();
          document.getElementById("info").textContent = `World '${worldId}' dimuat.`;
        } else {
          world = Array(worldSize).fill().map(() => Array(worldSize).fill(0));
          db.ref("worlds/" + worldId).set(world);
          document.getElementById("info").textContent = `World '${worldId}' baru dibuat.`;
        }
        drawWorld();
      });
    }

    function saveWorld() {
      db.ref("worlds/" + worldId).set(world);
      document.getElementById("info").textContent = `World '${worldId}' disimpan.`;
    }

    window.addEventListener("keydown", e => {
      if (e.key === "ArrowUp") player.y--;
      if (e.key === "ArrowDown") player.y++;
      if (e.key === "ArrowLeft") player.x--;
      if (e.key === "ArrowRight") player.x++;
      drawWorld();
    });

    setInterval(() => {
      player.frame = player.frame >= 10 ? 1 : player.frame + 1;
      player.image.src = `asset/hero/Idle (${player.frame}).png`;
      drawWorld();
    }, 200);

    loadWorld();
  </script>
</body>
</html>
